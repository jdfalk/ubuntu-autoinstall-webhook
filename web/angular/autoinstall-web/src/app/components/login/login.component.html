<!-- filepath: /web/angular/autoinstall-web/src/app/components/login/login.component.html -->
<div class="login-container">
    <mat-card>
        <mat-card-header>
            <mat-card-title>Ubuntu Autoinstall Webhook</mat-card-title>
            <mat-card-subtitle>Sign in to continue</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
            <div *ngIf="isLoading" class="loading-indicator">
                <mat-spinner diameter="40"></mat-spinner>
                <p>Authenticating...</p>
            </div>

            <div *ngIf="!isLoading">
                <!-- Auth method selector -->
                <mat-form-field appearance="outline" class="full-width" *ngIf="authMethods.length > 1">
                    <mat-label>Authentication Method</mat-label>
                    <mat-select [(value)]="selectedAuthMethod" (selectionChange)="onAuthMethodChange($event.value)">
                        <mat-option *ngFor="let method of authMethods" [value]="method">
                            {{ getAuthMethodLabel(method) }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>

                <!-- OAuth login button -->
                <div *ngIf="selectedAuthMethod === 'oauth'" class="oauth-container">
                    <p>Sign in using your identity provider</p>
                    <button mat-raised-button color="primary" (click)="initiateOAuthLogin()">
                        <mat-icon>login</mat-icon>
                        Sign in with {{ authConfig?.methods.oauth.provider_type || 'OAuth' }}
                    </button>
                </div>

                <!-- Username/password login form -->
                <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" *ngIf="selectedAuthMethod !== 'oauth'">
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Username</mat-label>
                        <input matInput formControlName="username" placeholder="Enter your username">
                        <mat-error *ngIf="loginForm.get('username')?.hasError('required')">
                            Username is required
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Password</mat-label>
                        <input matInput formControlName="password" type="password" placeholder="Enter your password">
                        <mat-error *ngIf="loginForm.get('password')?.hasError('required')">
                            Password is required
                        </mat-error>
                    </mat-form-field>

                    <div class="button-container">
                        <button mat-raised-button color="primary" type="submit" [disabled]="loginForm.invalid">
                            Sign In
                        </button>
                    </div>
                </form>
            </div>
        </mat-card-content>
    </mat-card>
</div>
